# Vatevo Demo Run Guide

**Complete demo flow for investor presentations and customer onboarding**

## Overview

This guide provides step-by-step instructions for running a comprehensive Vatevo demo, showcasing the platform's capabilities across different user personas and use cases.

## Prerequisites

### 1. Environment Setup
```bash
# Start the API server
cd apps/api
python -m uvicorn app.main:app --reload

# Start the dashboard (in another terminal)
cd apps/dashboard
npm run dev

# Start the marketing site (in another terminal)
cd apps/marketing
npm run dev
```

### 2. Demo Data Seeding
```bash
# Seed demo data
./ops/demo/seed.sh

# Verify data was created
curl -H "Authorization: Bearer demo-admin-key" http://localhost:8000/tenants
```

## Demo Personas

### 1. SMB (Small-Medium Business)
- **Company**: Acme SRL (Italy)
- **Plan**: Free
- **Use Case**: Basic e-invoicing compliance
- **API Key**: Generated by seed script

### 2. Marketplace
- **Company**: Multi-country marketplace
- **Plan**: Pro
- **Use Case**: High-volume invoice processing
- **API Key**: Generated by seed script

### 3. Enterprise
- **Company**: Large enterprise with multiple subsidiaries
- **Plan**: Enterprise
- **Use Case**: Complex compliance requirements
- **API Key**: Generated by seed script

## Demo Flow 1: API Integration (CLI/HTTP)

### Step 1: Health Check
```bash
# Check API health
curl http://localhost:8000/healthz
curl http://localhost:8000/health/ready
curl http://localhost:8000/health/db

# Expected output:
# {"status":"ok","service":"vatevo-api"}
# {"status":"ready","service":"vatevo-api"}
# {"status":"ok","database":"connected"}
```

### Step 2: Authentication & Tenant Setup
```bash
# List tenants (admin view)
curl -H "Authorization: Bearer demo-admin-key" http://localhost:8000/tenants

# Create new tenant
curl -X POST \
  -H "Authorization: Bearer demo-admin-key" \
  -H "Content-Type: application/json" \
  -d '{"name": "Demo Company", "webhook_url": "https://webhook.site/demo"}' \
  http://localhost:8000/tenants

# Create API key for tenant
curl -X POST \
  -H "Authorization: Bearer demo-admin-key" \
  -H "Content-Type: application/json" \
  -d '{"name": "Demo API Key", "expires_days": 365}' \
  http://localhost:8000/api-keys
```

### Step 3: Invoice Validation
```bash
# Validate invoice data
curl -X POST \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "country_code": "IT",
    "supplier": {
      "name": "Test Supplier",
      "vat_id": "IT12345678901",
      "address": "Via Roma 1",
      "city": "Milano",
      "postal_code": "20100",
      "country": "IT"
    },
    "customer": {
      "name": "Test Customer",
      "vat_id": "IT98765432109",
      "address": "Via Milano 2",
      "city": "Roma",
      "postal_code": "00100",
      "country": "IT"
    },
    "line_items": [{
      "description": "Test Item",
      "quantity": 1,
      "unit_price": "100.00",
      "tax_rate": 22.0,
      "tax_amount": "22.00",
      "line_total": "100.00"
    }]
  }' \
  http://localhost:8000/validate

# Expected output:
# {"valid": true, "errors": []}
```

### Step 4: Invoice Creation & Processing
```bash
# Create invoice
curl -X POST \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "country_code": "IT",
    "supplier": {
      "name": "Test Supplier",
      "vat_id": "IT12345678901",
      "address": "Via Roma 1",
      "city": "Milano",
      "postal_code": "20100",
      "country": "IT"
    },
    "customer": {
      "name": "Test Customer",
      "vat_id": "IT98765432109",
      "address": "Via Milano 2",
      "city": "Roma",
      "postal_code": "00100",
      "country": "IT"
    },
    "line_items": [{
      "description": "Test Item",
      "quantity": 1,
      "unit_price": "100.00",
      "tax_rate": 22.0,
      "tax_amount": "22.00",
      "line_total": "100.00"
    }]
  }' \
  http://localhost:8000/invoices

# Expected output:
# {"id": 1, "status": "validated", "country_code": "IT", ...}

# Check invoice status
curl -H "Authorization: Bearer YOUR_API_KEY" http://localhost:8000/invoices/1

# List all invoices
curl -H "Authorization: Bearer YOUR_API_KEY" http://localhost:8000/invoices
```

### Step 5: Webhook Testing
```bash
# Test webhook delivery
curl -X POST \
  -H "Authorization: Bearer YOUR_API_KEY" \
  http://localhost:8000/webhooks/test

# Expected output:
# {"success": true, "webhook_url": "https://webhook.site/demo", "event": {...}}

# List webhook events
curl -H "Authorization: Bearer YOUR_API_KEY" http://localhost:8000/webhooks/events
```

## Demo Flow 2: Dashboard Interface

### Step 1: Access Dashboard
1. Open browser to `http://localhost:3000`
2. Login with demo credentials
3. Navigate to tenant switcher

### Step 2: Tenant Management
1. **Switch Tenants**: Use dropdown to switch between:
   - demo-smb (Free plan)
   - demo-marketplace (Pro plan)
   - demo-enterprise (Enterprise plan)

2. **View Tenant Details**: Check API keys, webhook configuration, plan limits

### Step 3: Invoice Management
1. **Filter by Country**: Use country filter to show:
   - Italy (IT) invoices
   - Germany (DE) invoices
   - France (FR) invoices
   - Spain (ES) invoices
   - Netherlands (NL) invoices
   - Poland (PL) invoices

2. **Filter by Status**: Show invoices by status:
   - Validated (green)
   - Submitted (blue)
   - Accepted (green)
   - Rejected (red)
   - Failed (red)

3. **View Invoice Details**: Click on any invoice to see:
   - Supplier and customer information
   - Line items and totals
   - UBL XML (if available)
   - Processing history
   - Error messages (if any)

### Step 4: API Key Management
1. Navigate to Settings â†’ API Keys
2. View existing API keys
3. Create new API key
4. Test key rotation
5. Revoke old keys

## Demo Flow 3: SDK Integration

### TypeScript/Node.js SDK
```typescript
import { createClient } from '@vatevo/sdk';

const client = createClient({
  apiKey: 'your-api-key',
  baseUrl: 'http://localhost:8000'
});

// Health check
const health = await client.healthCheck();
console.log('API Health:', health);

// Create invoice
const invoice = await client.createInvoice({
  country_code: 'IT',
  supplier: {
    name: 'Test Supplier',
    vat_id: 'IT12345678901',
    address: 'Via Roma 1',
    city: 'Milano',
    postal_code: '20100',
    country: 'IT'
  },
  customer: {
    name: 'Test Customer',
    vat_id: 'IT98765432109',
    address: 'Via Milano 2',
    city: 'Roma',
    postal_code: '00100',
    country: 'IT'
  },
  line_items: [{
    description: 'Test Item',
    quantity: 1,
    unit_price: '100.00',
    tax_rate: 22.0,
    tax_amount: '22.00',
    line_total: '100.00'
  }]
});

console.log('Created Invoice:', invoice);

// List invoices
const invoices = await client.listInvoices();
console.log('Invoices:', invoices);

// Test webhook
const webhookTest = await client.testWebhook();
console.log('Webhook Test:', webhookTest);
```

### Python SDK
```python
from vatevo import create_client, InvoiceCreate, SupplierInfo, CustomerInfo, LineItem

client = create_client(
    api_key='your-api-key',
    base_url='http://localhost:8000'
)

# Health check
health = client.health_check()
print('API Health:', health)

# Create invoice
invoice_data = InvoiceCreate(
    country_code="IT",
    supplier=SupplierInfo(
        name="Test Supplier",
        vat_id="IT12345678901",
        address="Via Roma 1",
        city="Milano",
        postal_code="20100",
        country="IT"
    ),
    customer=CustomerInfo(
        name="Test Customer",
        vat_id="IT98765432109",
        address="Via Milano 2",
        city="Roma",
        postal_code="00100",
        country="IT"
    ),
    line_items=[
        LineItem(
            description="Test Item",
            quantity=1,
            unit_price="100.00",
            tax_rate=22.0,
            tax_amount="22.00",
            line_total="100.00"
        )
    ]
)

invoice = client.create_invoice(invoice_data)
print('Created Invoice:', invoice)

# List invoices
invoices = client.list_invoices()
print('Invoices:', invoices)

# Test webhook
webhook_test = client.test_webhook()
print('Webhook Test:', webhook_test)
```

## Demo Flow 4: Compliance Showcase

### Step 1: Multi-Country Support
1. **Italy (FatturaPA)**: Show FatturaPA XML generation
2. **Germany (XRechnung)**: Show XRechnung XML generation
3. **France (Factur-X)**: Show Factur-X XML generation
4. **Spain (EN16931)**: Show EN16931 XML generation
5. **Netherlands (EN16931)**: Show EN16931 XML generation
6. **Poland (KSeF)**: Show KSeF XML generation (stub)

### Step 2: Format Validation
1. **UBL 2.1**: Show UBL validation
2. **EN16931**: Show EN16931 validation
3. **Country-Specific**: Show country-specific validation rules

### Step 3: Gateway Integration
1. **SDI (Italy)**: Show SDI submission process
2. **Peppol**: Show Peppol submission process
3. **PPF (France)**: Show PPF submission process
4. **KSeF (Poland)**: Show KSeF submission process (stub)

## Demo Flow 5: Error Handling

### Step 1: Validation Errors
```bash
# Invalid VAT ID
curl -X POST \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "country_code": "IT",
    "supplier": {
      "name": "Test Supplier",
      "vat_id": "INVALID_VAT_ID",
      "address": "Via Roma 1",
      "city": "Milano",
      "postal_code": "20100",
      "country": "IT"
    },
    "customer": {
      "name": "Test Customer",
      "vat_id": "IT98765432109",
      "address": "Via Milano 2",
      "city": "Roma",
      "postal_code": "00100",
      "country": "IT"
    },
    "line_items": [{
      "description": "Test Item",
      "quantity": 1,
      "unit_price": "100.00",
      "tax_rate": 22.0,
      "tax_amount": "22.00",
      "line_total": "100.00"
    }]
  }' \
  http://localhost:8000/validate

# Expected output:
# {"valid": false, "errors": ["Invalid VAT ID format for Italy"]}
```

### Step 2: API Error Handling
```bash
# Invalid API key
curl -H "Authorization: Bearer invalid-key" http://localhost:8000/invoices

# Expected output:
# {"detail": "Invalid API key", "error_code": "INVALID_API_KEY"}

# Rate limiting (if configured)
# Make multiple requests quickly to trigger rate limiting

# Expected output:
# {"detail": "Rate limit exceeded", "error_code": "RATE_LIMIT_EXCEEDED"}
```

## Troubleshooting

### Common Issues

#### 1. API Not Running
```bash
# Check if API is running
curl http://localhost:8000/healthz

# Start API if not running
cd apps/api
python -m uvicorn app.main:app --reload
```

#### 2. Database Connection Issues
```bash
# Check database health
curl http://localhost:8000/health/db

# Check database URL in environment
echo $DATABASE_URL
```

#### 3. Demo Data Not Seeded
```bash
# Re-seed demo data
./ops/demo/seed.sh

# Check if data was created
curl -H "Authorization: Bearer demo-admin-key" http://localhost:8000/tenants
```

#### 4. Webhook Not Working
```bash
# Check webhook configuration
curl -H "Authorization: Bearer YOUR_API_KEY" http://localhost:8000/webhooks/test

# Verify webhook URL is accessible
curl -I https://webhook.site/demo
```

### Expected Outputs

#### Health Check
```json
{
  "status": "ok",
  "service": "vatevo-api"
}
```

#### Invoice Creation
```json
{
  "id": 1,
  "tenant_id": "tenant_123",
  "status": "validated",
  "country_code": "IT",
  "supplier_name": "Test Supplier",
  "customer_name": "Test Customer",
  "total_amount": "100.00",
  "created_at": "2025-09-09T12:00:00Z",
  "updated_at": "2025-09-09T12:00:00Z"
}
```

#### Webhook Test
```json
{
  "success": true,
  "webhook_url": "https://webhook.site/demo",
  "event": {
    "id": "evt_123",
    "type": "test.webhook",
    "created": "2025-09-09T12:00:00Z",
    "data": {
      "message": "Test webhook delivery",
      "timestamp": "2025-09-09T12:00:00Z"
    },
    "api_version": "1.0"
  }
}
```

## Demo Script for Presentations

### Opening (2 minutes)
1. **Problem Statement**: "EU e-invoicing compliance is complex and expensive"
2. **Solution**: "Vatevo provides a simple API for multi-country compliance"
3. **Demo Overview**: "I'll show you how easy it is to integrate"

### API Demo (5 minutes)
1. **Health Check**: Show API is running
2. **Create Invoice**: Show simple API call
3. **Validation**: Show business rules validation
4. **Multi-Country**: Show different country formats
5. **Webhooks**: Show real-time notifications

### Dashboard Demo (3 minutes)
1. **Login**: Show tenant management
2. **Invoice List**: Show filtering and status
3. **Invoice Detail**: Show XML and processing history
4. **API Keys**: Show key management

### SDK Demo (2 minutes)
1. **TypeScript**: Show SDK integration
2. **Python**: Show Python SDK
3. **Error Handling**: Show comprehensive error handling

### Compliance Demo (3 minutes)
1. **Multi-Country**: Show country support
2. **Format Validation**: Show validation rules
3. **Gateway Integration**: Show submission process

### Closing (2 minutes)
1. **Benefits**: "Simple, reliable, compliant"
2. **Next Steps**: "Ready for integration"
3. **Q&A**: Answer questions

---

**Total Demo Time**: 17 minutes  
**Preparation Time**: 5 minutes (start services, seed data)  
**Cleanup Time**: 2 minutes (reset demo data)
